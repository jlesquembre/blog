<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>GnuPG Notes | Lafuente</title><meta name="Description" content="I am writing about my experiences as a software developer."><link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Lafuente"><style>*,::after,::before{box-sizing:border-box}ol[class],ul[class]{padding:0}blockquote,body,dd,dl,figure,h1,h2,h3,h4,ol[class],p,ul[class]{margin:0}body{min-height:100vh;scroll-behavior:smooth;text-rendering:optimizeSpeed;line-height:1.5}ol[class],ul[class]{list-style:none}a:not([class]){text-decoration-skip-ink:auto}img{max-width:100%;display:block}article>*+*{margin-top:1em}button,input,select,textarea{font:inherit}img:not([alt]){filter:blur(10px)}@media(prefers-reduced-motion:reduce){*{animation-duration:NaNs!important;animation-iteration-count:1!important;transition-duration:NaNs!important;scroll-behavior:auto!important}}:root{--bg:#fafafa;--fg:#6c7680;--ui:#959da6;--text:#000000;--tag:#399ee6;--link:#399ee6;--side-bg:#1f2430;--side-fg:#cbccc6;--side-ui:#707a8c;--bg-m:#1f2430}*{box-sizing:border-box}body,html{padding:0;margin:0;font-family:system-ui,sans-serif;background-color:var(--bg)}html{height:100%}body{display:grid;grid-template-rows:1fr auto;grid-template-columns:30% 1fr 2.5rem;grid-column-gap:1rem;grid-row-gap:0;min-height:100%}header{grid-column:1;grid-row:1/2}main{grid-column:2;grid-row:1/3;padding:1rem}footer{grid-column:1;grid-row:2/3;position:sticky;bottom:0;display:flex;justify-content:center}.side{background-color:var(--side-bg);color:var(--side-fg)}a,a:hover,a:visited{text-decoration:none;color:inherit}main.blog p{margin:1.5em 0;font-size:20px;max-width:700px}main.blog a:not(.tag):not(.direct-link),main.blog a:not(.tag):not(.direct-link):visited{text-decoration:underline var(--link)}main.blog a:not(.tag):not(.direct-link):hover{color:var(--link);text-decoration:underline var(--link)}.title{padding:.5em 1em 0;display:inline-block;margin:0 0 1em 1em;background-color:var(--bg);color:var(--text)}.nav-item{padding:1.5em}.nav-item:hover{background-color:var(--ui);color:var(--text)}.nav-item-active,.nav-item-active:hover{font-weight:700;background-color:var(--bg);color:var(--text)}time{color:var(--fg)}.postlist-date{display:block}.postlist-item{margin:1.5em 0}.year-header{display:flex;color:var(--fg);border-bottom:1px dotted var(--fg)}.year-header>span{margin-left:auto}.year-header+.postlist-item{margin-top:0}.tag>span:first-child{color:var(--tag);padding:0 4px;border:1px solid rgba(0,0,0,.08)}.tag>span::before{content:""}.tag:hover>span:first-child{background-color:rgba(0,0,0,.08)}.tags-list{display:flex;flex-direction:column}.tags-list a{width:max-content}.tags-side span:first-child{border:none}.tags-side .tag:hover>span{background-color:var(--bg)}.direct-link{font-family:sans-serif;text-decoration:none;font-style:normal;margin-left:.1em}a[href].direct-link,a[href].direct-link:visited{color:transparent}:hover>a[href].direct-link,:hover>a[href].direct-link:visited,a[href].direct-link:focus,a[href].direct-link:focus:visited{color:#aaa}.sticky{position:sticky;top:1em}.summary-container{padding-top:30vh;display:grid;grid-template-columns:auto 1fr}.summary{padding:0 2em;margin:0 auto}.section-header{writing-mode:vertical-lr;text-orientation:upright;text-transform:capitalize}.social{display:flex;align-self:center;line-height:1em}.social svg{fill:var(--side-fg);width:2.5em}.icon-github svg:hover{fill:#000}.icon-twitter svg:hover{fill:#00c9ff}.icon-feed svg:hover{fill:#ff9132}a.social-icon{text-decoration:none;margin:0 .5em}#home{margin-left:auto;background-color:var(--bg);color:var(--fg);padding:.5em;text-decoration:none;display:none}#all-pages{display:block;background-color:#fff;position:fixed;padding:.25em;color:red;right:0}</style><link rel="stylesheet" href="/css/prism.css"></head><body>null<header class="side"><a href="/"><h1 class="title">Lafuente</h1></a><div class="sticky"><div class="social"><a class="social-icon icon-github" href="https://github.com/jlesquembre" title="@jlesquembre on GitHub"><svg viewBox="0 0 32 32"><path d="M16 0C7.163 0 0 7.163 0 16s7.163 16 16 16 16-7.163 16-16S24.837 0 16 0zm9.502 25.502a13.4 13.4 0 01-5.51 3.334v-2.398c0-1.26-.432-2.188-1.297-2.781.542-.052 1.039-.125 1.492-.219s.932-.229 1.438-.406.958-.388 1.359-.633.786-.563 1.156-.953.68-.833.93-1.328.448-1.089.594-1.781.219-1.456.219-2.289c0-1.615-.526-2.99-1.578-4.125.479-1.25.427-2.609-.156-4.078l-.391-.047c-.271-.031-.758.083-1.461.344s-1.492.688-2.367 1.281a14.367 14.367 0 00-3.859-.516c-1.344 0-2.625.172-3.844.516a13.39 13.39 0 00-1.57-.93c-.495-.245-.891-.411-1.188-.5s-.573-.143-.828-.164-.419-.026-.492-.016-.125.021-.156.031c-.583 1.479-.635 2.839-.156 4.078-1.052 1.135-1.578 2.51-1.578 4.125 0 .833.073 1.596.219 2.289s.344 1.286.594 1.781.56.938.93 1.328.755.708 1.156.953.854.456 1.359.633.984.313 1.438.406.951.167 1.492.219c-.854.583-1.281 1.51-1.281 2.781v2.445A13.4 13.4 0 016.5 25.501 13.4 13.4 0 012.563 16a13.4 13.4 0 013.936-9.502 13.4 13.4 0 014.272-2.881c1.654-.7 3.414-1.054 5.229-1.054s3.575.355 5.23 1.055a13.4 13.4 0 014.272 2.881A13.4 13.4 0 0129.438 16c0 1.815-.355 3.575-1.055 5.23a13.41 13.41 0 01-2.881 4.272z"/></svg> </a><a class="social-icon icon-twitter" href="https://twitter.com/jlesquembre" title="@jlesquembre on Twitter"><svg viewBox="0 0 32 32" fill="#00c9ff"><path d="M32 6.076a13.14 13.14 0 01-3.771 1.034 6.592 6.592 0 002.887-3.632 13.151 13.151 0 01-4.169 1.593 6.557 6.557 0 00-4.792-2.073 6.565 6.565 0 00-6.565 6.565c0 .515.058 1.016.17 1.496a18.64 18.64 0 01-13.532-6.86A6.536 6.536 0 001.339 7.5a6.563 6.563 0 002.921 5.465 6.54 6.54 0 01-2.974-.821l-.001.083a6.57 6.57 0 005.266 6.438 6.578 6.578 0 01-2.965.112 6.572 6.572 0 006.133 4.559 13.172 13.172 0 01-8.154 2.81c-.53 0-1.052-.031-1.566-.092a18.579 18.579 0 0010.064 2.95c12.076 0 18.679-10.004 18.679-18.68 0-.285-.006-.568-.019-.849A13.354 13.354 0 0032 6.076z"/></svg> </a><a class="social-icon icon-feed" href="/feed/feed.xml" title="José Luis Lafuente's RSS Feed"><svg viewBox="0 0 32 32" fill="#ff9132"><path d="M4.259 23.467A4.265 4.265 0 000 27.719a4.25 4.25 0 004.259 4.244 4.25 4.25 0 004.265-4.244c.001-2.336-1.906-4.252-4.265-4.252zM.005 10.873v6.133c3.993 0 7.749 1.562 10.577 4.391A14.897 14.897 0 0114.966 32h6.16C21.125 20.349 11.648 10.873.005 10.873zM.012 0v6.136C14.255 6.136 25.848 17.74 25.848 32H32C32 14.36 17.648 0 .012 0z"/></svg> </a><a href="/" id="home">Home</a></div><div class="summary-container"><h1 class="section-header">blog</h1><div class="summary"><div>24 Apr 2014</div><h3>GnuPG Notes</h3><div class="tags-list tags-side"><a href="/tags/gnupg" class="tag"><span>gnupg</span></a></div></div></div></div></header><main class="blog"><div class="date-tags-container"><time datetime="2014-04-24">24 Apr 2014</time> · <a href="/tags/gnupg" class="tag"><span>gnupg</span></a></div><h1>GnuPG Notes</h1><h2 id="create-new-key">Create new key <a class="direct-link" href="#create-new-key">#</a></h2><p>Create or edit the file <code>~/.gnupg/gpg.conf</code> and add the following lines to use the cryptographically stronger SHA512 hashing algorithm for signatures in preference to SHA1 algorithm.</p><pre class="language-text"><code class="language-text">personal-digest-preferences SHA512<br>cert-digest-algo SHA512<br>default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed</code></pre><p>Now we can generate the keys:</p><pre class="language-bash"><code class="language-bash">gpg --gen-key</code></pre><p>The system will prompt us to generate some entropy, we can just run this in other terminal. Any expensive operation over the file system, like <code>find</code> would we also ok.</p><pre class="language-bash"><code class="language-bash"><span class="token function">ls</span> -R ~</code></pre><p>By default we have one master key (for signing) and one subkey (for encryption)</p><h2 id="list-keys">List keys <a class="direct-link" href="#list-keys">#</a></h2><p>We can see our public keys with this command:</p><pre class="language-bash"><code class="language-bash">gpg --list-keys</code></pre><p>And our secret keys with this command:</p><pre class="language-bash"><code class="language-bash">gpg --list-secret-keys</code></pre><p>To see more information about the keys, we can use this command:</p><pre class="language-bash"><code class="language-bash">gpg --edit-key KEYID_or_EMAIL</code></pre><p>The output is something like this:</p><pre><code>Secret key is available.
pub  4096R/AB58430D  created: 2014-04-14  expires: never       usage: SC
                     trust: ultimate      validity: ultimate
sub  4096R/D5293C21  created: 2014-04-14  expires: never       usage: E
[ultimate] (1). John Doe &lt;jonh@gmail.com&gt;
</code></pre><p>Meaning of the usage field abbreviation:</p><table><thead><tr><th>Constant</th><th>Character</th></tr></thead><tbody><tr><td>PUBKEY_USAGE_SIG</td><td>S</td></tr><tr><td>PUBKEY_USAGE_CERT</td><td>C</td></tr><tr><td>PUBKEY_USAGE_ENC</td><td>E</td></tr><tr><td>PUBKEY_USAGE_AUTH</td><td>A</td></tr></tbody></table><p>Thus, for example, usage: SCA means that the sub-key can be used for signing, for creating a certificate and authentication purposes.</p><p>The primary user id is indicated by a dot, and selected keys or user ids are indicated by an asterisk</p><h2 id="user-id-management">User id management <a class="direct-link" href="#user-id-management">#</a></h2><p>Use the <code>gpg ‐‐edit-key</code> command to launch the <code>gpg&gt;</code> prompt.</p><p>Select a uid:</p><pre><code>gpg&gt; uid n
</code></pre><p><code>n</code> is the uid number. Use * to select all and 0 to deselect all.</p><p>Add a uid:</p><pre><code>gpg&gt; adduid
</code></pre><p>Make uid primary, before you need to select a uid:</p><pre><code>gpg&gt; primary
</code></pre><h2 id="create-subkey">Create subkey <a class="direct-link" href="#create-subkey">#</a></h2><p>For extra security, it might be appropriate to physically remove the master private key from your computer, and instead use a second generated subkey for signing files. You can sign and encrypt files as normal with your signing subkey and encryption subkey. If those keys ever get compromised, you can simply revoke them and generate new ones with your uncompromised master key.</p><pre><code>gpg --edit-key KEYID_or_EMAIL

gpg&gt; addkey
.
.
.
gpg&gt; save
</code></pre><h2 id="create-subkey-for-ssh-authentication">Create subkey for SSH authentication <a class="direct-link" href="#create-subkey-for-ssh-authentication">#</a></h2><p>You need to create a subkey for authentication. To do this, you need to run gpg in expert mode:</p><pre><code>gpg --expert --edit-key KEYID_or_EMAIL

gpg&gt; addkey

# Select (11) ECC (set your own capabilities)
# Select (1) Curve 25519
# Select successively (S), (E), and (A) to remove the signing and encryption capabilities and enable the authentication capability.

gpg&gt; save
</code></pre><p>To export your public ssh key:</p><pre class="language-bash"><code class="language-bash">gpg --export-ssh-key KEYID_or_EMAIL</code></pre><p>To make gnupg use your authentication key for ssh:</p><pre class="language-bash"><code class="language-bash">gpg --with-keygrip --list-public-keys KEYID_or_EMAIL</code></pre><p>And add the keygrip for the authentication key to <code>~/.gnupg/sshcontrol</code></p><h2 id="export-keys">Export keys <a class="direct-link" href="#export-keys">#</a></h2><pre class="language-bash"><code class="language-bash">gpg --armor --export KEYID_or_EMAIL <span class="token operator">></span> keyname.public.asc</code></pre><p><code>--armor</code> exports the key in ascii format. Is also posible use <code>--export-secret-key</code> or <code>--export-secret-subkeys</code></p><p><code>--export</code> exports your whole public key. It probably doesn't make sense to only export a public subkey (public keys are supposed to be public) and various important bits of information are tied to the main key in any case. Your user id, for example, is stored on the main key.</p><h2 id="import-subkeys">Import subkeys <a class="direct-link" href="#import-subkeys">#</a></h2><pre class="language-bash"><code class="language-bash">gpg --import subkey.asc</code></pre><p>It is not possible to delete only the secret master key. If you want to delete only the master secret key, you need to follow this steps:</p><ul><li><p>Export secret subkeys</p></li><li><p>Delete secret key</p></li></ul><pre class="language-bash"><code class="language-bash">gpg --delete-secret-key KEYID_or_EMAIL</code></pre><ul><li>Import secret subkeys</li></ul><p>You can verify it worked by running:</p><pre><code>gpg --list-secret-keys
/home/john/.gnupg/secring.gpg
-----------------------------
sec#  4096R/AB58430D 2014-04-14
uid                  John Doe &lt;jonh@gmail.com&gt;
ssb   4096R/D5293C21 2014-04-14
</code></pre><p>The pound sign <code>#</code> means the signing subkey is not in the keypair located in the keyring.</p><h2 id="encrypting-a-file">Encrypting a file <a class="direct-link" href="#encrypting-a-file">#</a></h2><pre class="language-bash"><code class="language-bash">gpg --recipient MY_KEY --recipient OTHER_KEY --encrypt message.txt</code></pre><p>The encrypted message is written to <code>message.txt.gpg</code></p><p>I wanted to make sure I could read the message too, for this reason I have two recipents.</p><h3 id="references">References <a class="direct-link" href="#references">#</a></h3><ul><li><a href="https://sanctum.geek.nz/arabesque/series/gnu-linux-crypto/">Series: GNU/Linux Crypto « Arabesque</a></li><li><a href="https://alexcabal.com/creating-the-perfect-gpg-keypair/">Creating the perfect GPG keypair</a></li><li><a href="http://unix.stackexchange.com/questions/31996/how-are-the-gpg-usage-flags-defined-in-the-key-details-listing">How are the GPG usage flags defined in the key details listing? - Unix &amp; Linux Stack Exchange</a></li></ul><p><a href="/">← Home</a></p></main><footer class="side"><a href="/about"><div class="nav-item">About</div></a><a href="/tags"><div class="nav-item">Categories</div></a><a href="/posts"><div class="nav-item">Archives</div></a></footer></body></html>